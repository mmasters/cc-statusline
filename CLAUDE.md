# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

A custom Claude Code statusline — a single bash script (`statusline.sh`) that transforms Claude Code's JSON session data into a 6-line colored terminal display showing directory/git info, environment, context usage, session timer, cost/tokens, and rotating tips.

Generated by the npm package `@chongdashu/cc-statusline` v1.4.0. Source: https://github.com/chongdashu/cc-statusline

## No Build/Test/Lint

This is a standalone bash script with no build system, test suite, or linter. To test changes, run it with sample JSON piped to stdin:

```bash
echo '{"cwd":"/tmp","model":"claude-opus-4-6","contextWindow":{"used":0.15,"total":200000}}' | bash statusline.sh
```

The script is deployed to `~/.claude/statusline.sh` and configured via `~/.claude/settings.json`.

## Architecture

**Input:** JSON from Claude Code piped via stdin
**Output:** 6 lines of ANSI-colored text
**Dependencies:** `jq` (optional, has pure-bash fallback), `git` (optional)

### Script Structure (statusline.sh)

| Lines     | Section                                                    |
|-----------|------------------------------------------------------------|
| 1–20      | Header, version, input capture, jq detection               |
| 21–32     | Color helper functions (ANSI 256-color)                    |
| 33–80     | JSON extraction utilities (jq primary, grep/sed fallback)  |
| 83–130    | Data extraction: directory, model, version, MCP, hooks     |
| 132–192   | Git integration: branch, changes, ahead/behind, stash      |
| 194–228   | Context window percentage calculation                      |
| 230–294   | Cost, token counts, burn rate, tokens/minute               |
| 296–314   | Session reset time (5-hour rolling window)                 |
| 316–403   | Rendering: assembles and prints the 6 output lines         |
| 405–461   | Tips array (45 entries) and final output                   |

### Key Design Patterns

- **Graceful degradation:** Every feature has a fallback. jq unavailable → bash parsing. Git unavailable → skip git line. Missing JSON fields → sensible defaults.
- **Dual JSON parsing:** `HAS_JQ` flag controls whether `jq` or `extract_json_string()` (grep/sed) is used.
- **Dynamic colors:** Context bar color shifts green→peach→red based on usage %. Session timer color shifts similarly.
- **Data sources:** Session JSON (stdin) for model/context/cost, `~/.claude/settings.json` for MCP/hooks counts, `git` commands for repo status.

### Customization Points

- **Colors:** Edit the named color functions (e.g., `dir_color()`, `model_color()`) near line 25.
- **Progress bar:** Width set in render section (~line 375), characters in `progress_bar()` function (~line 50).
- **Tips:** Array starting ~line 406. Rotation speed controlled by divisor in `$(date +%s) / 60`.
